C51 COMPILER V9.52.0.0   UART                                                              04/10/2024 17:26:02 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN uart.OBJ
COMPILER INVOKED BY: F:\all_for_51\keil\C51\BIN\C51.EXE uart.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "reg52.h"
   2          #include "motor.h"
   3          #include "string.h"
   4          
   5          #define SIZE 12
   6          sfr AUXR = 0x8E;
   7          char buffer[SIZE];
   8          
   9          void UartInit(void)   //9600bps@11.0592MHz
  10          {
  11   1        AUXR=0x01; //减少定时器辐射 -- 抗干扰
  12   1        SCON =0x50; //配置 串口口工作方式1，REN 使能接收
  13   1        //不配 PCON  -- 不设置倍数关系
  14   1        //配置定时器1为 8位自动重装
  15   1        TMOD &=0xF0; //高位清零
  16   1        TMOD |=0x20;  //00 10  -- 配置为定时器1为: 1 0 模式 -- 8位自动重装
  17   1        
  18   1        //定义初值
  19   1        TL1=0xFD;
  20   1        TH1=0xFD; // 9600 波特率的初值
  21   1        TR1= 1; // 定时器 -- 启动
  22   1        
  23   1        EA =1; // 开启总中断
  24   1        ES=1;  // 开启串口中断
  25   1        
  26   1      }
  27          
  28          
  29          void uartHandler() interrupt 4
  30          {
  31   1        static int  i = 0;
  32   1        char tmp;
  33   1       if(RI) // 中断处理函数中，对于接收中断的响应
  34   1       {
  35   2          RI=0; //清楚接收中断标志位
  36   2          tmp = SBUF;
  37   2          if(tmp == 'M')
  38   2             i=0;
  39   2          buffer[i++]=tmp;
  40   2          if(buffer[0] == 'M'){
  41   3            switch(buffer[1]){
  42   4            case '1':
  43   4                goForward();
  44   4                break;
  45   4          
  46   4            case '2':
  47   4                goBack();
  48   4                break;
  49   4            
  50   4            case '3':
  51   4                goLeft();
  52   4                break;
  53   4          
  54   4            case '4':
  55   4                goRight();
C51 COMPILER V9.52.0.0   UART                                                              04/10/2024 17:26:02 PAGE 2   

  56   4                break;
  57   4            default://前提是M开关，但不是上面4跳到额指令不然就进不来了
  58   4              stop();
  59   4              break;
  60   4            
  61   4            }
  62   3          
  63   3          }
  64   2         if(i == SIZE) {
  65   3           i = 0;
  66   3           memset(buffer,'\0',SIZE);
  67   3          }
  68   2       }
  69   1        
  70   1        
  71   1      }
  72          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    179    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
